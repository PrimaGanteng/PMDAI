let recognition,useGpt4=!1;document.getElementById("sendButton").addEventListener("click",sendMessage),document.getElementById("userInput").addEventListener("keypress",(function(e){if("Enter"===e.key)if(e.preventDefault(),e.ctrlKey){document.getElementById("userInput").value+="\n"}else sendMessage()}));let isRecording=!1;function updateRecordingIcon(){document.getElementById("toggleRecording").innerHTML=isRecording?'<i class="fas fa-stop"></i>':'<i class="fa fa-microphone"></i>'}function sendMessage(){const e=document.getElementById("userInput").value.trim(),n=document.getElementById("messages");if(""===e)return;isRecording&&(recognition.stop(),isRecording=!1,updateRecordingIcon());const t=document.createElement("div");t.className="message user-message",t.innerText=e,n.appendChild(t),document.getElementById("userInput").value="",setTimeout((()=>{t.style.opacity=1,t.style.transform="translateY(0)"}),30),t.scrollIntoView({behavior:"smooth",block:"end"});const o=document.createElement("div");o.className="message loading",o.innerHTML='\n        <div class="typing-indicator">\n            <div></div>\n            <div></div>\n            <div></div>\n        </div>\n    ',n.appendChild(o),o.scrollIntoView({behavior:"smooth",block:"end"}),fetch(`${window.location.origin}/api/ask`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,username:"defaultUser  ",useGpt4:useGpt4})}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")})).then((e=>{console.log("Data from API:",e),n.removeChild(o);const t=document.createElement("div");t.className="message bot-message",e.reply?t.innerText=e.reply:e.data&&e.data.reply?t.innerText=e.data.reply:t.innerText="Tidak ada jawaban dari AI.",n.appendChild(t),setTimeout((()=>{t.style.opacity=1,t.style.transform="translateY(0)"}),10),setTimeout((()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"});const e=t.getBoundingClientRect().top+window.scrollY-40;window.scrollTo({top:e,behavior:"smooth"})}),100),isRecording&&recognition.start()})).catch((e=>{console.error("Error occurred:",e),n.removeChild(o);const t=document.createElement("div");t.className="message ai-message",t.innerText=`Terjadi kesalahan saat menghubungi AI: ${e.message}`,n.appendChild(t),setTimeout((()=>{t.style.opacity=1,t.style.transform="translateY(0)"}),10),t.scrollIntoView({behavior:"smooth",block:"end"}),document.getElementById("userInput").focus()})),isRecording?(updateRecordingIcon(),document.getElementById("toggleRecording").focus()):updateRecordingIcon()}"webkitSpeechRecognition"in window&&(recognition=new webkitSpeechRecognition,recognition.continuous=!0,recognition.interimResults=!1,recognition.onresult=function(e){const n=e.results[e.results.length-1][0].transcript;document.getElementById("userInput").value=n,sendMessage()},recognition.onerror=function(e){console.error("Error occurred in recognition: "+e.error),isRecording=!1,updateRecordingIcon()},recognition.onend=function(){isRecording&&(isRecording=!1,updateRecordingIcon())}),document.getElementById("toggleRecording").addEventListener("click",(function(){isRecording?(recognition.stop(),isRecording=!1,updateRecordingIcon()):(recognition.start(),isRecording=!0,updateRecordingIcon())})),document.getElementById("switchBotButton").addEventListener("click",(function(){const e=useGpt4?"Apakah Anda ingin mengganti ke PMD AI?":"Apakah Anda ingin mengganti ke PMD AI 2.0?";document.getElementById("popupMessage").innerText=e;const n=document.getElementById("botSwitchPopup");n.style.display="block",n.style.opacity=1,document.getElementById("changeButton").onclick=function(){useGpt4=!useGpt4;const e=useGpt4?"PMD AI 2.0":"PMD AI";console.log(`Switched to ${e}!`);let t=setInterval((function(){n.style.opacity>0?n.style.opacity-=.1:(clearInterval(t),n.style.display="none")}),50)}}));